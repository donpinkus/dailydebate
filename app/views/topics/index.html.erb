<div class="container">
  <div class="row">
    <div class="col-sm-12">
      <div class="alert alert-info indexHeader">
        <div class="lead">
          <p>
            2Sided is a place where opinions are debated.
          </p>
          <p class="antiTroll">
            To maintain healthy debate, only post serious comments.  We're here to educate each other and learn from different perspectives.
          </p>
        </div>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="topicsFeed col-sm-9">
      <% if params[:category] %>
        <div class="alert alert-warning categoryFilterAlert">
          Filtered by <%= render partial: "categories/category", locals: {category: @category, show_count: true} %>
          <a href="/topicss" class="pull-right removeFilters">
            <i class="glyphicon glyphicon-remove"></i>
          </a>
        </div>
      <% end %>

      <% @topics.each do |topic| %>
        <div class="topicContainer" data-topic-id="<%= topic.id %>">
          <div class="topic">
            <span class="pull-right"><i class="glyphicon glyphicon-star-empty text-muted"></i></span>

            <p class="smallCaps topicMetaInfo">
              <img class="squareAvatar"
              src="https://graph.facebook.com/<%= topic.user.uid %>/picture?width=32&height=32"
              height="14px">
              opinion on

              <%= topic.categories.map { |cat| link_to(cat.name.downcase, "/category/#{cat.name.parameterize}") }.join(', ').html_safe %>
            </p>

            <h4 class="title"><%= link_to topic.title, topic, class: "topicLink" %></h4>
            <div class="topicFooter">
              <div class="btn-group topicActions">
                <button class="btn btn-default btn-xs voteBtn smallCaps" data-is-agree="1">
                  agree
                  <small class="text-muted">&nbsp; <%= topic.agree_votes.where(is_agree: true).count %></small>
                </button>
                <button class="btn btn-default btn-xs voteBtn smallCaps" data-is-agree="0">
                  disagree
                  <small class="text-muted">&nbsp; <%= topic.agree_votes.where(is_agree: false).count %></small>
                </button>
              </div>
              &nbsp;
              <% if topic.comments.count > 0 %>
                <span class="text-muted answerCount"><%= pluralize(topic.comments.count, "comment") %></span>
              <% end %>
            </div>

            <div class="agreeCommentForm hidden">
              <br/>
              <%= form_for Comment.new do |f| %>
                <%= f.hidden_field :topic_id, value: topic.id %>
                <%= f.hidden_field :is_agree, value: 1 %>
                <div class="form-group">
                  <label>Why do you agree? <small class="text-muted">Optional</small></label>
                  <% placeholder_text = 1 ? "Why do you agree?" : "Why do you disagree?" %>
                  <%= f.text_area :content, rows: 10, class: "form-control", placeholder: "Enter explanation..." %>
                </div>
                <%= f.submit class: "submitCommentBtn btn btn-small btn-primary", value: "Post" %>
              <% end %>
            </div>
            <div class="disagreeCommentForm hidden">
              <br/>
              <%= form_for Comment.new do |f| %>
                <%= f.hidden_field :topic_id, value: topic.id %>
                <%= f.hidden_field :is_agree, value: 0 %>
                <div class="form-group">
                  <label>Why do you disagree? <small class="text-muted">Optional</small></label>
                  <% placeholder_text = 0 ? "Why do you agree?" : "Why do you disagree?" %>
                  <%= f.text_area :content, rows: 10, class: "form-control", placeholder: "Enter explanation..." %>
                </div>
                <%= f.submit class: "submitCommentBtn btn btn-small btn-primary", value: "Post" %>
              <% end %>
            </div>

          </div>
        </div>
      <% end %>
    </div>
    <div class="categoryContainer col-sm-3">
      <h3 class="contentHeader">filter</h3>
      <ul class="filters">
        <% Category.all.each do |category| %>
          <li>
            <a href="/topics?sort=<%= params[:sort] %>&tag=<%= category.name.parameterize %>"
              data-toggle="tooltip"
              data-placement="top"
              title="<%= category.description %>">
              <%= category.name.downcase %>
              <span class="count">
                <%= category.topics.count %>
              </span>
            </a>
          </li>
        <% end %>
      </ul>
    </div>
  </div>
</div>


